<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Twin Factory - –ó–∞–¥–∞—á–∏</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="navbar">
            <a href="/" class="navbar-brand">üè≠ Digital Twin Factory</a>
            <ul class="navbar-menu">
                <li class="navbar-item"><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li class="navbar-item"><a href="/generator">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</a></li>
                <li class="navbar-item active"><a href="/jobs">–ó–∞–¥–∞—á–∏</a></li>
                <li class="navbar-item"><a href="/analytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a></li>
                <li class="navbar-item"><a href="/api/docs">API</a></li>
            </ul>
        </nav>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 class="card-title">üìã –ó–∞–¥–∞—á–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h1>
                    <p style="color: #6c757d;">–ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –¥–∞–Ω–Ω—ã—Ö</p>
                </div>
                <button class="btn btn-primary" onclick="window.location.reload()">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
                <div class="stat-value" id="totalJobs">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                <div class="stat-value" id="completedJobs">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚è≥</div>
                <div class="stat-label">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</div>
                <div class="stat-value" id="activeJobs">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚ùå</div>
                <div class="stat-label">–û—à–∏–±–∫–∏</div>
                <div class="stat-value" id="failedJobs">0</div>
            </div>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–¥–∞—á -->
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID –∑–∞–¥–∞—á–∏</th>
                        <th>–ü–∞—Ü–∏–µ–Ω—Ç—ã</th>
                        <th>–í–∏–∑–∏—Ç—ã</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                    </tr>
                </thead>
                <tbody id="jobsTableBody">
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px;">
                            <div style="font-size: 1.2rem; color: #6c757d;">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...</div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- –§—É—Ç–µ—Ä -->
        <div class="footer">
            <p>Digital Twin Factory ¬© 2024 | –í–µ—Ä—Å–∏—è 2.0.0</p>
        </div>
    </div>

    <script>
        async function loadJobs() {
            try {
                const response = await fetch('/api/v1/jobs');
                const jobs = await response.json();
                
                const total = jobs.length;
                const completed = jobs.filter(j => j.status === 'completed').length;
                const active = jobs.filter(j => j.status === 'processing' || j.status === 'pending').length;
                const failed = jobs.filter(j => j.status === 'failed').length;
                
                document.getElementById('totalJobs').textContent = total;
                document.getElementById('completedJobs').textContent = completed;
                document.getElementById('activeJobs').textContent = active;
                document.getElementById('failedJobs').textContent = failed;
                
                let html = '';
                if (jobs.length === 0) {
                    html = '<tr><td colspan="5" style="text-align: center; padding: 40px;">üì≠ –ù–µ—Ç –∑–∞–¥–∞—á</td></tr>';
                } else {
                    jobs.slice(0, 10).forEach(job => {
                        let statusClass = '';
                        let statusText = job.status || 'pending';
                        
                        if (statusText === 'completed') statusClass = 'badge-success';
                        else if (statusText === 'processing' || statusText === 'pending') statusClass = 'badge-primary';
                        else if (statusText === 'failed') statusClass = 'badge-danger';
                        
                        html += `<tr>
                            <td><code>${job.job_id ? job.job_id.substring(0, 8) : 'N/A'}...</code></td>
                            <td>${job.patients || 0}</td>
                            <td>${job.visits || 0}</td>
                            <td><span class="badge ${statusClass}">${statusText}</span></td>
                            <td>${job.created_at ? new Date(job.created_at).toLocaleString() : 'N/A'}</td>
                        </tr>`;
                    });
                }
                
                document.getElementById('jobsTableBody').innerHTML = html;
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('jobsTableBody').innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px; color: #dc3545;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</td></tr>';
            }
        }
        
        loadJobs();
        setInterval(loadJobs, 5000);
    </script>
</body>
</html>