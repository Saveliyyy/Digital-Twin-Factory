<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Twin Factory - –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</title>
    <link rel="stylesheet" href="/static/css/dark-theme.css">
    <link rel="stylesheet" href="/static/css/theme-switcher.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ */
        .progress-container {
            margin: 30px 0;
            padding: 20px;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            display: none;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .progress-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .progress-percent {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-color, #667eea);
        }
        
        .progress-bar-container {
            width: 100%;
            height: 24px;
            background: var(--bg-secondary);
            border-radius: 50px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color, #667eea), var(--accent-secondary, #764ba2));
            border-radius: 50px;
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-status {
            margin-top: 15px;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border-radius: 12px;
            border-left: 4px solid var(--accent-color, #667eea);
            font-size: 0.95rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-icon {
            font-size: 1.2rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .status-text {
            flex: 1;
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin: 30px 0 20px;
            position: relative;
        }
        
        .progress-steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border-color);
            z-index: 1;
        }
        
        .step {
            position: relative;
            z-index: 2;
            background: var(--bg-card);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            border: 2px solid var(--border-color);
            transition: all 0.3s;
        }
        
        .step.active {
            background: linear-gradient(135deg, var(--accent-color, #667eea), var(--accent-secondary, #764ba2));
            border-color: transparent;
            color: white;
            box-shadow: 0 0 20px var(--accent-color, #667eea);
        }
        
        .step.completed {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }
        
        .step-label {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            white-space: nowrap;
            color: var(--text-muted);
        }
        
        .generator-hero {
            background: linear-gradient(135deg, var(--accent-color, #667eea), var(--accent-secondary, #764ba2));
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            text-align: center;
            color: white;
        }
        
        .param-panel {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }
        
        .param-group {
            margin-bottom: 25px;
        }
        
        .param-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .param-label {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .param-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-color, #667eea);
        }
        
        .param-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, var(--accent-color, #667eea), var(--accent-secondary, #764ba2));
            -webkit-appearance: none;
        }
        
        .param-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--accent-color, #667eea);
            cursor: pointer;
            box-shadow: 0 0 15px var(--accent-color, #667eea);
            transition: transform 0.2s;
            border: 2px solid white;
        }
        
        .param-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        
        .quick-presets {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .preset-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .preset-btn:hover {
            background: linear-gradient(135deg, var(--accent-color, #667eea), var(--accent-secondary, #764ba2));
            color: white;
            border-color: transparent;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-color, #667eea), var(--accent-secondary, #764ba2));
            color: white;
            flex: 2;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--accent-color, #667eea);
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            flex: 1;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, var(--accent-color, #667eea), var(--accent-secondary, #764ba2));
            color: white;
            border-color: transparent;
        }
        
        .result-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 12px;
            display: none;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .result-success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            color: #10b981;
        }
        
        .result-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #ef4444;
        }
        
        .download-section {
            margin-top: 20px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 12px;
            display: none;
            animation: slideIn 0.5s ease;
        }
        
        .download-options {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .format-badge {
            background: linear-gradient(135deg, var(--accent-color, #667eea), var(--accent-secondary, #764ba2));
            color: white;
            padding: 8px 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .format-badge:hover {
            transform: scale(1.05);
        }
        
        .stats-preview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 30px;
        }
        
        .stat-preview-item {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            border-left: 4px solid var(--accent-color, #667eea);
        }
        
        .stat-preview-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent-color, #667eea);
        }
        
        .stat-preview-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
    </style>
</head>
<body class="dark-theme">
    <div class="container">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="navbar">
            <a href="/" class="navbar-brand">üè≠ Digital Twin Factory</a>
            <ul class="navbar-menu">
                <li class="navbar-item"><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li class="navbar-item active"><a href="/generator">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</a></li>
                <li class="navbar-item"><a href="/dashboard">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a></li>
                <li class="navbar-item"><a href="/analytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a></li>
                <li class="navbar-item"><a href="/tariffs">–¢–∞—Ä–∏—Ñ—ã</a></li>
                <li class="navbar-item"><a href="/developer">üë®‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</a></li>
                <li class="navbar-item"><a href="#" onclick="logout()">–í—ã—Ö–æ–¥</a></li>
                <li class="navbar-item">
                    <div class="theme-switch-wrapper">
                        <label class="theme-switch">
                            <input type="checkbox" id="theme-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                </li>
            </ul>
        </nav>

        <!-- Hero —Å–µ–∫—Ü–∏—è -->
        <div class="generator-hero">
            <h1 style="font-size: 2.5rem; margin-bottom: 15px;">üöÄ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö</h1>
            <p style="font-size: 1.2rem; opacity: 0.9;">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–∞—Ç–∞—Å–µ—Ç—ã –∑–∞ —Å–µ–∫—É–Ω–¥—ã</p>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ -->
        <div class="param-panel">
            <h2 style="margin-bottom: 25px; color: var(--accent-color);">‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h2>
            
            <!-- –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã -->
            <div class="quick-presets">
                <span class="preset-btn" onclick="setPreset('small')">–ú–∞–ª–µ–Ω—å–∫–∏–π (1k)</span>
                <span class="preset-btn" onclick="setPreset('medium')">–°—Ä–µ–¥–Ω–∏–π (10k)</span>
                <span class="preset-btn" onclick="setPreset('large')">–ë–æ–ª—å—à–æ–π (50k)</span>
                <span class="preset-btn" onclick="setPreset('xlarge')">–û–≥—Ä–æ–º–Ω—ã–π (100k)</span>
            </div>

            <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π -->
            <div class="param-group">
                <div class="param-header">
                    <span class="param-label">üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π</span>
                    <span class="param-value" id="recordsValue">10,000</span>
                </div>
                <input type="range" id="recordsSlider" class="param-slider" min="100" max="100000" value="10000" step="100">
                <div class="param-limits" style="display: flex; justify-content: space-between; margin-top: 5px; color: var(--text-muted);">
                    <span>100</span>
                    <span>100,000</span>
                </div>
            </div>

            <!-- Seed -->
            <div class="param-group">
                <div class="param-header">
                    <span class="param-label">üé≤ Seed (–≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å)</span>
                    <span class="param-value" id="seedValue">42</span>
                </div>
                <input type="range" id="seedSlider" class="param-slider" min="1" max="9999" value="42" step="1">
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="startGeneration()" id="generateBtn">
                    ‚ö° –ó–ê–ü–£–°–¢–ò–¢–¨ –ì–ï–ù–ï–†–ê–¶–ò–Æ
                </button>
                <button class="btn btn-secondary" onclick="resetParams()">
                    üîÑ –°–ë–†–û–°
                </button>
            </div>

            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä -->
            <div id="progressContainer" class="progress-container">
                <div class="progress-header">
                    <div class="progress-title">
                        <span>‚è≥</span>
                        <span id="progressTitle">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</span>
                    </div>
                    <div class="progress-percent" id="progressPercent">0%</div>
                </div>
                
                <!-- –®–∞–≥–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
                <div class="progress-steps">
                    <div class="step" id="step1">
                        1
                        <span class="step-label">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</span>
                    </div>
                    <div class="step" id="step2">
                        2
                        <span class="step-label">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è</span>
                    </div>
                    <div class="step" id="step3">
                        3
                        <span class="step-label">–û–±—Ä–∞–±–æ—Ç–∫–∞</span>
                    </div>
                    <div class="step" id="step4">
                        4
                        <span class="step-label">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</span>
                    </div>
                </div>
                
                <!-- –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -->
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progressBar"></div>
                </div>
                
                <!-- –°—Ç–∞—Ç—É—Å -->
                <div class="progress-status">
                    <span class="status-icon" id="statusIcon">‚öôÔ∏è</span>
                    <span class="status-text" id="statusText">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞...</span>
                </div>
            </div>

            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ -->
            <div id="resultMessage" class="result-message"></div>

            <!-- –°–µ–∫—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è -->
            <div id="downloadSection" class="download-section">
                <h3 style="color: var(--accent-color); margin-bottom: 15px;">üì• –†–µ–∑—É–ª—å—Ç–∞—Ç –≥–æ—Ç–æ–≤</h3>
                <p id="downloadInfo" style="color: var(--text-muted); margin-bottom: 15px;"></p>
                <div class="download-options">
                    <span class="format-badge" onclick="downloadFile('json')">üìÑ JSON</span>
                    <span class="format-badge" onclick="downloadFile('csv')">üìä CSV</span>
                    <span class="format-badge" onclick="downloadFile('excel')">üìó Excel</span>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
        <div class="stats-preview">
            <div class="stat-preview-item">
                <div class="stat-preview-value" id="previewRecords">0</div>
                <div class="stat-preview-label">–ó–∞–ø–∏—Å–µ–π</div>
            </div>
            <div class="stat-preview-item">
                <div class="stat-preview-value" id="previewSize">0 MB</div>
                <div class="stat-preview-label">–†–∞–∑–º–µ—Ä</div>
            </div>
            <div class="stat-preview-item">
                <div class="stat-preview-value" id="previewTime">0 —Å</div>
                <div class="stat-preview-label">–í—Ä–µ–º—è</div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let currentJobId = null;
        let progressInterval = null;
        let startTime = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            initSliders();
            checkAuth();
            updatePreview();
        };

        function initSliders() {
            const recordsSlider = document.getElementById('recordsSlider');
            const seedSlider = document.getElementById('seedSlider');

            recordsSlider.addEventListener('input', function(e) {
                document.getElementById('recordsValue').textContent = Number(e.target.value).toLocaleString();
                updatePreview();
            });

            seedSlider.addEventListener('input', function(e) {
                document.getElementById('seedValue').textContent = e.target.value;
            });
        }

        function updatePreview() {
            const records = document.getElementById('recordsSlider').value;
            document.getElementById('previewRecords').textContent = Number(records).toLocaleString();
            document.getElementById('previewSize').textContent = (records * 0.001).toFixed(1) + ' MB';
            document.getElementById('previewTime').textContent = (records / 1000).toFixed(1) + ' —Å';
        }

        function setPreset(size) {
            const recordsSlider = document.getElementById('recordsSlider');
            switch(size) {
                case 'small':
                    recordsSlider.value = 1000;
                    break;
                case 'medium':
                    recordsSlider.value = 10000;
                    break;
                case 'large':
                    recordsSlider.value = 50000;
                    break;
                case 'xlarge':
                    recordsSlider.value = 100000;
                    break;
            }
            document.getElementById('recordsValue').textContent = Number(recordsSlider.value).toLocaleString();
            updatePreview();
        }

        function resetParams() {
            document.getElementById('recordsSlider').value = 10000;
            document.getElementById('seedSlider').value = 42;
            document.getElementById('recordsValue').textContent = '10,000';
            document.getElementById('seedValue').textContent = '42';
            updatePreview();
        }

        async function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/login';
                return;
            }
        }

        function startGeneration() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('resultMessage').style.display = 'none';
            document.getElementById('downloadSection').style.display = 'none';
            document.getElementById('generateBtn').disabled = true;
            
            startTime = Date.now();
            let progress = 0;
            
            // –°–±—Ä–æ—Å —à–∞–≥–æ–≤
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active', 'completed');
            });
            document.getElementById('step1').classList.add('active');
            
            progressInterval = setInterval(() => {
                progress += 1;
                
                if (progress <= 100) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
                    document.getElementById('progressBar').style.width = progress + '%';
                    document.getElementById('progressPercent').innerHTML = progress + '%';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏ —à–∞–≥–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                    if (progress < 20) {
                        document.getElementById('statusText').innerHTML = '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞...';
                        document.getElementById('statusIcon').innerHTML = '‚öôÔ∏è';
                    } else if (progress < 40) {
                        document.getElementById('statusText').innerHTML = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...';
                        document.getElementById('statusIcon').innerHTML = 'üìä';
                        updateSteps(1, 2);
                    } else if (progress < 60) {
                        document.getElementById('statusText').innerHTML = '–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π...';
                        document.getElementById('statusIcon').innerHTML = 'üîÑ';
                        updateSteps(2, 3);
                    } else if (progress < 80) {
                        document.getElementById('statusText').innerHTML = '–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...';
                        document.getElementById('statusIcon').innerHTML = '‚ö°';
                        updateSteps(3, 4);
                    } else if (progress < 95) {
                        document.getElementById('statusText').innerHTML = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...';
                        document.getElementById('statusIcon').innerHTML = 'üíæ';
                    } else {
                        document.getElementById('statusText').innerHTML = '–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ...';
                        document.getElementById('statusIcon').innerHTML = '‚úÖ';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                    document.getElementById('progressTitle').innerHTML = `–ì–µ–Ω–µ—Ä–∞—Ü–∏—è ${progress}%`;
                }
                
                if (progress >= 100) {
                    completeGeneration();
                }
            }, 50);
        }

        function updateSteps(currentStep, nextStep) {
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`step${i}`);
                if (i < currentStep) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (i === currentStep) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            }
        }

        function completeGeneration() {
            clearInterval(progressInterval);
            
            // –û—Ç–º–µ—á–∞–µ–º –≤—Å–µ —à–∞–≥–∏ –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`step${i}`).classList.add('completed');
                document.getElementById(`step${i}`).classList.remove('active');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            document.getElementById('statusText').innerHTML = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!';
            document.getElementById('statusIcon').innerHTML = 'üéâ';
            document.getElementById('progressTitle').innerHTML = '–ì–æ—Ç–æ–≤–æ!';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            setTimeout(() => {
                document.getElementById('progressContainer').style.display = 'none';
                document.getElementById('downloadSection').style.display = 'block';
                document.getElementById('generateBtn').disabled = false;
                
                const records = document.getElementById('recordsSlider').value;
                const endTime = Date.now();
                const duration = ((endTime - startTime) / 1000).toFixed(1);
                
                document.getElementById('downloadInfo').innerHTML = `
                    ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ${Number(records).toLocaleString()} –∑–∞–ø–∏—Å–µ–π –∑–∞ ${duration} —Å–µ–∫—É–Ω–¥<br>
                    –§–æ—Ä–º–∞—Ç—ã –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:
                `;
            }, 500);
        }

        function downloadFile(format) {
            const records = document.getElementById('recordsSlider').value;
            const seed = document.getElementById('seedSlider').value;
            
            // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            const data = {
                generated_at: new Date().toISOString(),
                records: records,
                seed: seed,
                data: Array.from({ length: 100 }, (_, i) => ({
                    id: i + 1,
                    value: Math.random() * 100
                }))
            };
            
            let content = '';
            let filename = `generated_data_${new Date().getTime()}`;
            let mimeType = '';
            
            switch(format) {
                case 'json':
                    content = JSON.stringify(data, null, 2);
                    mimeType = 'application/json';
                    filename += '.json';
                    break;
                case 'csv':
                    content = 'id,value\n';
                    data.data.forEach(item => {
                        content += `${item.id},${item.value}\n`;
                    });
                    mimeType = 'text/csv';
                    filename += '.csv';
                    break;
                case 'excel':
                    alert('Excel —Ñ–æ—Ä–º–∞—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
                    return;
            }
            
            const blob = new Blob([content], { type: mimeType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/';
        }
    </script>
</body>
</html>
