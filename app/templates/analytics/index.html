<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Twin Factory - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</title>
    <link rel="stylesheet" href="/static/css/dark-theme.css">
    <link rel="stylesheet" href="/static/css/theme-switcher.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style id="industry-theme"></style>
    <style>
        .industry-header {
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            color: white;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            border-bottom: 4px solid;
        }
        
        .kpi-value {
            font-size: 2.2rem;
            font-weight: bold;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 25px;
        }
        
        .chart-container {
            height: 300px;
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .insight-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 25px;
            border-left: 4px solid;
        }
    </style>
</head>
<body class="dark-theme">
    <div class="container">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="navbar">
            <a href="/" class="navbar-brand">üè≠ Digital Twin Factory</a>
            <ul class="navbar-menu">
                <li class="navbar-item"><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li class="navbar-item"><a href="/generator">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</a></li>
                <li class="navbar-item"><a href="/dashboard">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a></li>
                <li class="navbar-item active"><a href="/analytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a></li>
                <li class="navbar-item"><a href="/tariffs">–¢–∞—Ä–∏—Ñ—ã</a></li>
                <li class="navbar-item"><a href="/developer">üë®‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</a></li>
                <li class="navbar-item"><a href="#" onclick="logout()">–í—ã—Ö–æ–¥</a></li>
                <li class="navbar-item">
                    <div class="theme-switch-wrapper">
                        <label class="theme-switch">
                            <input type="checkbox" id="theme-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                </li>
            </ul>
        </nav>

        <!-- –ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π —Ö–µ–¥–µ—Ä -->
        <div class="industry-header" id="industryHeader">
            <div style="display: flex; align-items: center; gap: 20px;">
                <div style="font-size: 4rem;" id="industryIcon">üè•</div>
                <div>
                    <h1 style="color: white;" id="industryTitle">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - –ó–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</h1>
                    <p style="color: rgba(255,255,255,0.9);" id="industrySubtitle">–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –≤ –≤–∞—à–µ–π –æ—Ç—Ä–∞—Å–ª–∏</p>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="kpi-grid" id="kpiCards"></div>

        <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
        <div class="chart-grid">
            <div class="chart-card">
                <h3 id="mainChartTitle">–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏</h3>
                <div class="chart-container">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3 id="secondaryChartTitle">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</h3>
                <div class="chart-container">
                    <canvas id="secondaryChart"></canvas>
                </div>
            </div>
        </div>

        <!-- –ò–Ω—Å–∞–π—Ç—ã -->
        <div class="insights-grid" id="insights"></div>
    </div>

    <script>
        let currentUser = null;
        
        const analyticsData = {
            healthcare: {
                name: "–ó–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ",
                icon: "üè•",
                color: "#f72585",
                kpis: [
                    { label: "–ü–∞—Ü–∏–µ–Ω—Ç–æ–≤", value: "12,450" },
                    { label: "–í–∏–∑–∏—Ç–æ–≤", value: "62,250" },
                    { label: "–î–∏–∞–±–µ—Ç", value: "8.2%" },
                    { label: "–°—Ä. —Å—Ç–æ–∏–º–æ—Å—Ç—å", value: "$152" }
                ],
                mainData: [65, 72, 78, 85, 82, 88, 92, 95, 89, 84, 79, 73],
                secondaryData: [30, 25, 18, 15, 12],
                secondaryLabels: ["–ü—Ä–æ—Å—Ç—É–¥–∞", "–ì—Ä–∏–ø–ø", "–ì–∏–ø–µ—Ä—Ç–æ–Ω–∏—è", "–î–∏–∞–±–µ—Ç", "–ê—Ä—Ç—Ä–∏—Ç"],
                insights: [
                    "–†–æ—Å—Ç –¥–∏–∞–±–µ—Ç–∞ –Ω–∞ 2.3%",
                    "–°–µ–∑–æ–Ω–Ω—ã–π —Ä–æ—Å—Ç –û–†–í–ò –∑–∏–º–æ–π",
                    "–¢–æ—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö: 98.5%"
                ]
            },
            finance: {
                name: "–§–∏–Ω–∞–Ω—Å—ã",
                icon: "üí∞",
                color: "#f8961e",
                kpis: [
                    { label: "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π", value: "45,678" },
                    { label: "–°—Ä. —Å—É–º–º–∞", value: "$1,250" },
                    { label: "ROI", value: "12.5%" },
                    { label: "–ü—Ä–æ—Å—Ä–æ—á–∫–∏", value: "3.2%" }
                ],
                mainData: [45, 52, 58, 62, 68, 72, 75, 78, 82, 85, 88, 92],
                secondaryData: [35, 25, 20, 12, 8],
                secondaryLabels: ["–ü–µ—Ä–µ–≤–æ–¥—ã", "–ü–ª–∞—Ç–µ–∂–∏", "–ö—Ä–µ–¥–∏—Ç—ã", "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏", "–°–±–µ—Ä–µ–∂–µ–Ω–∏—è"],
                insights: [
                    "–†–æ—Å—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π +25%",
                    "–°–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ—Å—Ä–æ—á–µ–∫",
                    "–ü–∏–∫ –≤ –¥–µ–∫–∞–±—Ä–µ"
                ]
            },
            retail: {
                name: "–†–∏—Ç–µ–π–ª",
                icon: "üõçÔ∏è",
                color: "#4cc9f0",
                kpis: [
                    { label: "–ü—Ä–æ–¥–∞–∂–∏", value: "234,567" },
                    { label: "–°—Ä. —á–µ–∫", value: "$85" },
                    { label: "–ö–æ–Ω–≤–µ—Ä—Å–∏—è", value: "3.2%" },
                    { label: "LTV", value: "$450" }
                ],
                mainData: [55, 58, 62, 68, 72, 75, 78, 82, 85, 88, 92, 95],
                secondaryData: [30, 25, 20, 15, 10],
                secondaryLabels: ["–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞", "–û–¥–µ–∂–¥–∞", "–ü—Ä–æ–¥—É–∫—Ç—ã", "–¢–µ—Ö–Ω–∏–∫–∞", "–ö–æ—Å–º–µ—Ç–∏–∫–∞"],
                insights: [
                    "–†–æ—Å—Ç –≤ –¥–µ–∫–∞–±—Ä–µ 40%",
                    "–ü–æ–ø—É–ª—è—Ä–Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
                    "–õ–æ—è–ª—å–Ω–æ—Å—Ç—å +23%"
                ]
            }
        };

        async function loadUser() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/login';
                return;
            }

            try {
                const response = await fetch('/api/v1/auth/me', {
                    headers: {'Authorization': `Bearer ${token}`}
                });
                currentUser = await response.json();
                loadAnalytics(currentUser.industry);
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function loadAnalytics(industry) {
            const data = analyticsData[industry] || analyticsData.healthcare;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É
            document.getElementById('industryHeader').style.background = `linear-gradient(135deg, ${data.color}, ${adjustColor(data.color, -20)})`;
            document.getElementById('industryIcon').textContent = data.icon;
            document.getElementById('industryTitle').textContent = `–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - ${data.name}`;
            document.getElementById('industrySubtitle').textContent = `–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –≤ ${data.name.toLowerCase()}`;
            
            // KPI
            const kpisHtml = data.kpis.map(k => `
                <div class="kpi-card" style="border-bottom-color: ${data.color};">
                    <div class="kpi-value" style="color: ${data.color};">${k.value}</div>
                    <div class="kpi-label">${k.label}</div>
                </div>
            `).join('');
            document.getElementById('kpiCards').innerHTML = kpisHtml;
            
            // –ì—Ä–∞—Ñ–∏–∫–∏
            createCharts(data, data.color);
            
            // –ò–Ω—Å–∞–π—Ç—ã
            const insightsHtml = data.insights.map(i => `
                <div class="insight-card" style="border-left-color: ${data.color};">
                    <div style="color: ${data.color}; font-weight: bold;">üí° –ò–Ω—Å–∞–π—Ç</div>
                    <p style="color: var(--text-muted);">${i}</p>
                </div>
            `).join('');
            document.getElementById('insights').innerHTML = insightsHtml;
        }

        function createCharts(data, color) {
            // –ì–ª–∞–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
            new Chart(document.getElementById('mainChart'), {
                type: 'line',
                data: {
                    labels: ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π', '–ò—é–Ω', '–ò—é–ª', '–ê–≤–≥', '–°–µ–Ω', '–û–∫—Ç', '–ù–æ—è', '–î–µ–∫'],
                    datasets: [{
                        data: data.mainData,
                        borderColor: color,
                        backgroundColor: `rgba(${hexToRgb(color)}, 0.1)`,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // –í—Ç–æ—Ä–æ–π –≥—Ä–∞—Ñ–∏–∫
            new Chart(document.getElementById('secondaryChart'), {
                type: 'doughnut',
                data: {
                    labels: data.secondaryLabels,
                    datasets: [{
                        data: data.secondaryData,
                        backgroundColor: [color, '#4cc9f0', '#f8961e', '#4361ee', '#3f37c9']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function adjustColor(color, amount) {
            return color;
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : '109, 40, 217';
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/';
        }

        window.onload = loadUser;
    </script>
</body>
</html>
